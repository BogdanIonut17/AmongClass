@using System.Linq

@{
    ViewBag.Title = "Întrebări";
    var questions = ViewBag.Questions as IEnumerable<dynamic>;
    bool hasQuestions = questions != null && questions.Any();
}

<div class="page-header">
    <h1><i class="bi bi-question-circle-fill"></i> Întrebări Among Class</h1>
    <p>Răspunde și votează care răspuns crezi că e generat de AI!</p>
</div>

<div class="text-center mb-4">
    <a class="btn btn-success-modern btn-modern mx-2" href="/Answers/Index">
        <i class="bi bi-chat-dots-fill"></i> Afișare răspunsuri
    </a>
    @if (User.IsInRole("Teacher"))
    {
        <a class="btn btn-primary-modern btn-modern mx-2" href="/Questions/New">
            <i class="bi bi-plus-circle-fill"></i> Adaugă întrebare
        </a>
    }
</div>

<div class="row g-4">
    @foreach (var q in ViewBag.Questions)
    {
        <div class="col-md-6 col-lg-4">
            <div class="card-modern h-100">
                <div class="card-body d-flex flex-column">
                    <div class="mb-3">
                        <span class="badge-modern bg-primary">
                            <i class="bi bi-chat-left-text"></i> @q.Answers.Count răspunsuri
                        </span>
                    </div>

                    <h5 class="card-title mb-3 text-white">@q.Text</h5>

                    @if (q.Answers.Count > 0)
                    {
                        <div class="mb-3">
                            <small class="text-secondary">Ultimele răspunsuri:</small>
                            @{
                                int answerCount = 0;
                            }
                            @foreach (var a in q.Answers)
                            {
                                if (answerCount >= 2) break;

                                <div class="mt-2 p-2" style="background: rgba(139, 92, 246, 0.1); border-radius: 8px; border-left: 3px solid var(--primary-color);">
                                    <small class="text-white-50">
                                        <i class="bi bi-quote"></i> @(a.Text.Length > 50 ? a.Text.Substring(0, 50) + "..." : a.Text)
                                    </small>
                                </div>

                                answerCount++;
                            }
                        </div>
                    }

                    <div class="mt-auto">
                        <a class="btn btn-primary-modern btn-modern w-100" href="/Questions/Show/@q.Id">
                            <i class="bi bi-eye"></i> Vezi detalii
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@if (ViewBag.Questions == null || ((IEnumerable<dynamic>)ViewBag.Questions).Count() == 0)
{
    <div class="text-center py-5">
        <i class="bi bi-inbox" style="font-size: 5rem; color: var(--text-secondary);"></i>
        @if (User.IsInRole("Teacher"))
        {
            <h3 class="mt-3 text-secondary">Nu există întrebări încă</h3>
            <p class="text-secondary">Fii primul care adaugă o întrebare!</p>
            <a class="btn btn-primary-modern btn-modern mt-3" href="/Questions/New">
                <i class="bi bi-plus-circle"></i> Adaugă prima întrebare</a>
        }
    </div>
}